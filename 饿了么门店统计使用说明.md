# 饿了么门店ID统计工具 - 使用说明

## 📋 项目概述

这是一个基于Python的饿了么门店ID批量统计工具，可以自动读取Excel代运营账单文件，批量查询门店ID对应的结算金额，并计算绩效。

## ✨ 功能特性

- ✅ **自动读取Excel文件** - 支持读取饿了么代运营账单Excel格式
- ✅ **批量门店ID查询** - 自动提取文件中所有唯一门店ID并进行统计
- ✅ **结算金额汇总** - 计算每个门店ID的结算金额总和
- ✅ **绩效计算** - 支持自定义绩效百分比进行绩效金额计算
- ✅ **统计报告导出** - 自动生成Excel统计报告(包含详情和汇总)
- ✅ **编码兼容** - 完美处理Windows控制台编码问题

## 📊 执行结果示例

根据最新执行结果:
- **总门店数量**: 53个
- **找到数据门店数**: 53个
- **汇总金额**: 611.10元
- **绩效金额**(30%): 183.33元

## 🚀 快速开始

### 方式一: 自动化批量统计(推荐)

直接运行自动化脚本，自动处理文件中的所有门店ID:

```bash
python run_eleme_statistics.py
```

**执行流程**:
1. 自动读取Excel文件
2. 自动提取所有唯一门店ID
3. 批量分析门店数据
4. 计算绩效(默认30%)
5. 自动导出Excel报告

### 方式二: 手动指定门店ID统计

运行交互式脚本，手动输入需要查询的门店ID:

```bash
python eleme_store_statistics.py
```

**交互流程**:
1. 程序提示输入门店ID(多个用逗号分隔)
2. 程序分析指定门店的数据
3. 提示输入绩效百分比
4. 询问是否导出Excel报告

## 📁 文件结构

```
jixiaotongji/
├── eleme_store_statistics.py          # 核心统计类(可交互)
├── run_eleme_statistics.py            # 自动化执行脚本(推荐)
├── 饿了么门店统计使用说明.md           # 本说明文档
└── 5349094916_20250921_20251007代运营固定费用账单_1759889236749.xlsx  # 数据源
```

## 📦 依赖安装

确保已安装以下Python库:

```bash
pip install pandas openpyxl
```

## 📝 Excel数据格式要求

输入Excel文件应包含以下列(按列索引):
- **列0**: 商家名称
- **列1**: 门店ID
- **列4**: 结算金额

示例数据格式:
```
商家名称    | 门店ID     | ... | 结算金额
-----------|-----------|-----|----------
尺八武士    | 1300598513| ... | 35.00
尺八武士    | 1300598513| ... | -1.05
```

## 💻 核心功能说明

### 1. ElemeStoreStatistics 类

**核心方法**:
- `read_excel_file()` - 读取Excel文件
- `analyze_store_data(store_ids)` - 批量分析门店数据
- `calculate_performance(percentage)` - 计算绩效金额
- `print_summary()` - 打印统计汇总
- `export_to_excel(output_path)` - 导出Excel报告

### 2. 自动化执行脚本

- 自动提取文件中的所有唯一门店ID
- 批量分析所有门店数据
- 默认30%绩效计算
- 自动导出Excel报告(文件名包含时间戳)

## 📊 输出报告格式

导出的Excel文件包含两个工作表:

### 工作表1: 门店统计详情
| 门店ID     | 商家名称         | 结算金额 | 数据行数 | 状态     |
|-----------|-----------------|---------|---------|---------|
| 1300598513| 尺八武士        | 33.95   | 2       | 匹配成功 |
| 1303600710| 昨辣           | 33.95   | 2       | 匹配成功 |

### 工作表2: 统计汇总
| 总门店数 | 找到数据门店数 | 未找到数据门店数 | 汇总金额 |
|---------|---------------|----------------|---------|
| 53      | 53            | 0              | 611.10  |

## 🔍 常见问题

### Q: 如何修改绩效百分比?
A: 编辑 `run_eleme_statistics.py` 文件中的 `performance_percentage = 30.0` 这一行，修改为你需要的百分比。

### Q: 如何更换数据源文件?
A: 修改两个脚本中的 `excel_path` 变量，指向新的Excel文件路径。

### Q: 控制台输出乱码怎么办?
A: 脚本已经处理了编码问题，使用 `[成功]`、`[OK]` 等ASCII标记替代特殊字符。

### Q: 如何只统计部分门店ID?
A: 使用 `eleme_store_statistics.py` 交互式脚本，手动输入需要查询的门店ID。

## 📌 注意事项

1. **Excel格式**: 确保Excel文件格式符合饿了么代运营账单标准格式
2. **门店ID类型**: 门店ID必须为8-10位整数
3. **结算金额**: 支持正负金额(如退款为负数)
4. **数据去重**: 系统会自动提取唯一门店ID，避免重复统计
5. **文件编码**: 脚本已处理Windows控制台编码问题

## 🎯 技术特点

- **智能列识别**: 使用列索引而非列名，避免中文编码问题
- **数据类型处理**: 自动转换门店ID为整数类型
- **异常处理**: 完善的错误处理机制
- **结果可视化**: 控制台实时显示处理进度和结果
- **报告生成**: 自动生成带时间戳的Excel报告

## 📈 性能优化

- 使用pandas高效处理大数据量
- 批量查询避免重复读取
- 列索引访问提升速度

## 🔧 开发团队

呈尚策划数据统计系统

---

**最后更新**: 2025-10-08
**版本**: v1.0.0
