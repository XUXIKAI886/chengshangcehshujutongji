# 饿了么固定费用统计

> 基于门店ID的饿了么固定费用结算金额统计分析系统

## 🎯 项目概述

这是一个现代化的Web应用，参考"饿了么门店ID统计专业版"设计，专门用于统计分析饿了么固定费用账单数据。

## ✨ 核心特性

### 🎨 现代化UI设计
- **紫色渐变主题** - 优雅的紫色配色方案 (#9b59b6)
- **毛玻璃效果** - 半透明背景与模糊效果
- **响应式布局** - 完美适配桌面、平板、手机
- **流畅动画** - fadeIn、slideInUp动画效果
- **Font Awesome图标** - 专业图标库支持

### 📊 实时统计卡片
- **查询门店总数** (紫色) - 显示输入的门店ID总数
- **找到数据门店** (绿色) - 显示匹配成功的门店数量
- **总结算周期数** (橙色) - 所有门店的结算周期汇总
- **结算金额汇总** (红色) - 所有门店的金额合计

### 🔧 强大功能

#### 1. 文件上传
- ✅ 支持拖拽上传Excel文件
- ✅ 支持点击选择文件
- ✅ 自动验证文件格式 (.xls/.xlsx)
- ✅ 显示文件大小信息

#### 2. 智能Excel解析
- ✅ 自动检测特殊格式（首行为标题行）
- ✅ 兼容"门店ID"和"门店id"两种字段名
- ✅ 兼容"结算金额"、"结算金额(元)"和"代运营结算金额"字段
- ✅ 自动过滤无效数据行

#### 3. 门店ID批量查询
- ✅ Textarea支持多行输入
- ✅ 每行一个门店ID
- ✅ 支持批量粘贴
- ✅ 8-10位数字格式验证

#### 4. 数据统计分析
- ✅ 基于门店ID精确匹配
- ✅ 按结算周期去重统计天数
- ✅ 汇总结算金额
- ✅ 区分"有结算"和"无数据"状态

#### 5. 订单识别与绩效计算
- ✅ 自动识别订单：门店总结算金额=33.95元计为1单
- ✅ 按单收取：固定7元/单
- ✅ 实时显示总订单数和绩效总额
- ✅ 动态显示/隐藏

#### 6. 报告导出
- ✅ 导出Excel格式报告
- ✅ 包含详细数据和汇总统计
- ✅ 自动生成带时间戳的文件名

## 🚀 快速开始

### 1. 启动本地服务器

由于项目使用ES6模块，需要通过HTTP服务器运行：

```bash
# Python方案
python -m http.server 8000

# Node.js方案
npx serve .

# PHP方案
php -S localhost:8000
```

### 2. 访问应用

打开浏览器访问：
```
http://localhost:8000/daiyunying-pro/
```

### 3. 使用步骤

1. **上传Excel文件** - 拖拽或点击选择饿了么账单Excel文件
2. **输入门店ID** - 在右侧文本框输入门店ID（每行一个）
3. **开始分析** - 点击"开始分析"按钮
4. **查看结果** - 查看统计卡片和详细表格
5. **导出报告** - 点击"导出报告"生成Excel文件

## 📁 项目结构

```
daiyunying-pro/
├── index.html                  # 主页面
├── assets/
│   ├── css/
│   │   └── styles.css         # 样式文件
│   └── js/
│       └── main.js            # 业务逻辑
└── README.md                   # 本说明文档
```

## 📋 Excel数据格式要求

### 标准格式

Excel文件应包含以下字段：
- **商家名称** 或 **店铺名称** 或 **门店名称** - 门店的名称
- **门店ID** 或 **门店id** - 8-10位数字
- **结算周期** - 用于去重统计结算天数
- **结算金额** 或 **结算金额(元)** 或 **代运营结算金额** - 结算金额

### 支持的特殊格式

支持首行为标题的Excel格式：
```
第1行: "饿了么账单" (标题行，自动跳过)
第2行: 商家名称 | 门店ID | 结算周期 | ... (字段名)
第3行+: 数据行
```

### 示例数据

```
商家名称        | 门店ID      | 结算周期     | 结算金额(元)
---------------|------------|-------------|-------------
尺八武士        | 1300598513 | 2025-09-21  | 35.00
尺八武士        | 1300598513 | 2025-09-21  | -1.05
昨辣           | 1303600710 | 2025-09-21  | 35.00
```

## 💡 使用技巧

### 快速批量输入门店ID

1. 从Excel"门店ID"列复制数据
2. 直接粘贴到门店ID输入框
3. 系统自动识别每行数据

### 订单识别与绩效计算

- **订单识别规则**：每个门店的总结算金额为33.95元时，计为1单
- **绩效标准**：固定7元/单
- **计算公式**：绩效总额 = 总订单数 × 7元
- **实时显示**：自动统计总订单数和绩效总额

### 数据筛选

系统会自动：
- 过滤空行和无效数据
- 去重统计结算周期
- 标记未找到数据的门店

## 🔍 技术特点

### 前端技术栈
- **HTML5** - 语义化标签
- **CSS3** - 渐变、动画、毛玻璃效果
- **JavaScript (ES6)** - 模块化开发
- **Layui 2.9.0** - UI组件库
- **Font Awesome 6.4.0** - 图标库
- **XLSX.js 0.18.5** - Excel文件处理

### 核心功能实现

#### 智能Excel解析
```javascript
// 自动检测特殊格式
if (headers.length === 1 && headers[0].includes('账单')) {
    // 跳过标题行，使用第二行作为字段名
    headerRowIndex = 1;
}
```

#### 字段兼容性
```javascript
// 兼容多种字段名
const storeId = row['门店ID'] || row['门店id'];
const amount = row['结算金额'] || row['结算金额(元)'] || row['代运营结算金额'];
const storeName = row['商家名称'] || row['店铺名称'] || row['门店名称'];
```

#### 订单识别算法
```javascript
// 计算门店总金额
const amount = storeData.reduce((sum, row) => {
    const settlementAmount = parseFloat(row['结算金额'] || 0);
    return sum + settlementAmount;
}, 0);

// 如果门店总金额为33.95元，计为1单
const orderCount = (Math.abs(amount - 33.95) < 0.01) ? 1 : 0;
```

#### 绩效计算
```javascript
// 统计所有门店的订单总数
const totalOrders = analysisResults.details.reduce((sum, item) =>
    sum + item.orderCount, 0
);

// 绩效金额 = 总订单数 × 7元/单
const performance = totalOrders * 7;
```

## 📊 输出报告格式

导出的Excel文件包含：

### 详细数据表
| 合同开始时间 | 门店ID | 商家名称 | 结算金额 | 订单数 | 记录数 | 状态 |
|------------|--------|---------|---------|--------|--------|------|
| 2025-09-01 | 1300598513 | 尺八武士 | 33.95 | 1 | 2 | 有结算数据 |
| 2025-09-01 | 1303600710 | 昨辣 | 33.95 | 1 | 2 | 有结算数据 |

### 汇总统计
- 查询门店总数
- 找到数据门店
- 总结算周期数
- 结算金额汇总
- 总订单数
- 绩效金额（¥7/单）

## 🎯 与饿了么专业版的对比

| 功能特性 | 饿了么专业版 | 饿了么固定费用统计 |
|---------|------------|------------|
| 主题色 | 蓝色 (#0089ff) | 紫色 (#9b59b6) |
| 字段名 | 门店id、代运营结算金额 | 门店ID、结算金额(元) |
| 统计维度 | 账单日期 | 结算周期 |
| 绩效默认值 | 3% | 30% |
| 特殊格式 | 标准格式 | 支持标题行 |

## 🔧 浏览器兼容性

- ✅ Chrome 80+
- ✅ Firefox 75+
- ✅ Safari 13+
- ✅ Edge 80+

## 📝 更新日志

### v1.0.0 (2025-10-08)
- ✅ 完成核心功能开发
- ✅ 实现现代化UI设计
- ✅ 支持拖拽上传
- ✅ 智能Excel解析
- ✅ 实时统计卡片
- ✅ 绩效计算功能
- ✅ Excel报告导出

## 💡 常见问题

### Q: 为什么门店ID没有匹配到数据？
A: 请检查：
1. Excel文件中是否有该门店ID的数据
2. 门店ID格式是否正确（8-10位数字）
3. 字段名是否为"门店ID"或"门店id"

### Q: 如何处理特殊格式的Excel？
A: 系统会自动检测并处理以下特殊格式：
- 首行为标题（如"饿了么账单"）
- 兼容"门店ID"和"门店id"
- 兼容"结算金额(元)"和"代运营结算金额"

### Q: 结算周期数是如何统计的？
A: 按"结算周期"字段去重统计，每个唯一的结算周期计为1次。

## 👨‍💻 开发团队

**呈尚策划数据统计系统**

---

**版本**: v1.0.0
**最后更新**: 2025-10-08
**许可证**: MIT
