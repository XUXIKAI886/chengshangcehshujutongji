# 字段兼容性说明

## 📊 支持的Excel字段名

系统已经优化为支持多种常见的字段名称,确保最大的兼容性。

### 1. 商家名称字段 (必需)

系统会按优先级自动识别以下字段:

| 优先级 | 字段名 | 说明 |
|--------|--------|------|
| 1 | `商家名称` | 最常见的字段名 |
| 2 | `店铺名称` | 饿了么部分账单使用 |
| 3 | `门店名称` | 其他平台可能使用 |

**代码实现**:
```javascript
const storeName = storeData[0]['商家名称'] ||
                 storeData[0]['店铺名称'] ||
                 storeData[0]['门店名称'] ||
                 '未知商家';
```

### 2. 门店ID字段 (必需)

| 优先级 | 字段名 | 说明 |
|--------|--------|------|
| 1 | `门店ID` | 标准字段名(首字母大写) |
| 2 | `门店id` | 部分账单使用(小写id) |

**格式要求**: 8-10位数字

### 3. 结算金额字段 (必需)

| 优先级 | 字段名 | 说明 |
|--------|--------|------|
| 1 | `结算金额` | 最简洁的字段名 |
| 2 | `结算金额(元)` | 带单位的字段名 |
| 3 | `代运营结算金额` | 详细的字段名 |

**代码实现**:
```javascript
const settlementAmount = parseFloat(
    row['结算金额'] ||
    row['结算金额(元)'] ||
    row['代运营结算金额'] ||
    0
);
```

### 4. 结算周期字段 (必需)

| 字段名 | 说明 |
|--------|------|
| `结算周期` | 用于去重统计结算天数 |

## 📋 实际案例分析

### 案例1: 当前测试文件

**文件**: `5349094916_20250921_20251007代运营固定费用账单_1759889236749.xlsx`

**字段结构**:
```
列0:  商家名称      ← 系统识别为商家名称
列1:  门店ID        ← 系统识别为门店ID
列4:  结算金额      ← 系统识别为结算金额
列10: 结算周期      ← 系统识别为结算周期
```

**结果**: ✅ 完美匹配,所有字段正常识别

### 案例2: 其他可能的格式

#### 格式A
```
店铺名称 | 门店id | 结算金额(元) | 结算周期
```
**结果**: ✅ 支持

#### 格式B
```
门店名称 | 门店ID | 代运营结算金额 | 结算周期
```
**结果**: ✅ 支持

#### 格式C (不支持)
```
店名 | StoreID | Amount | Period
```
**结果**: ❌ 不支持 - 字段名不匹配

## 🔧 如何验证字段兼容性

### 方法1: 浏览器控制台检查

1. 上传Excel文件
2. 按F12打开控制台
3. 查看日志输出:

```javascript
字段名: ['商家名称', '门店ID', ..., '结算金额', ..., '结算周期']
Excel数据处理完成，共 71 条记录
前3条数据样本: [...]
```

### 方法2: 查看错误提示

如果字段不匹配,会显示具体缺少哪个字段:

```
Excel文件缺少"结算金额"、"结算金额(元)"或"代运营结算金额"字段
```

## 📝 字段添加指南

如果您的Excel文件字段名不在支持列表中,可以:

### 选项1: 修改Excel文件 (推荐)

将字段名改为支持的名称:
- `店名` → `商家名称`
- `Store ID` → `门店ID`
- `Amount` → `结算金额`

### 选项2: 请求添加支持

如果您的字段名有特殊要求,可以反馈给开发团队添加支持。

## 🎯 最佳实践

### 推荐的Excel字段结构

```
商家名称 | 门店ID | 结算周期 | 结算金额
-------|--------|---------|--------
尺八武士 | 1300598513 | 2025-09-30 | 35.00
昨辣    | 1303600710 | 2025-09-30 | 35.00
```

**优点**:
- ✅ 字段名清晰易懂
- ✅ 直接兼容系统
- ✅ 无需额外处理

## 📊 字段优先级说明

当Excel文件包含多个兼容字段时,系统按以下优先级选择:

1. **商家名称** > 店铺名称 > 门店名称
2. **门店ID** > 门店id
3. **结算金额** > 结算金额(元) > 代运营结算金额

**示例**:
如果Excel同时包含"商家名称"和"店铺名称",系统会优先使用"商家名称"。

## 🔍 常见问题

### Q: 为什么要支持多种字段名?

**A**: 不同平台、不同时期的账单可能使用不同的字段名称。支持多种字段名可以提高系统的通用性和易用性。

### Q: 如果我的字段名都不匹配怎么办?

**A**:
1. 最简单的方法是修改Excel文件的字段名
2. 或者联系开发团队添加新的字段名支持

### Q: 系统如何判断字段是否存在?

**A**: 系统使用JavaScript的逻辑或运算符(`||`),按优先级依次检查:
```javascript
row['商家名称'] || row['店铺名称'] || row['门店名称'] || '未知商家'
```
如果前面的字段不存在或为空,会自动使用后面的字段。

---

**版本**: v1.0.2
**更新时间**: 2025-10-08
**项目**: 饿了么固定费用统计
